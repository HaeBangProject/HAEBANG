# <img width="60" alt="bemo_icon" src="https://github.com/HaeBangProject/HAEBANG/assets/59076085/128deff0-b54c-46aa-ba85-130f52dba780"> HAEBANG

<br>
<br>

## ğŸš€[HAEBANG ì ‘ì†í•˜ê¸°](https://www.haebang.site)

## ëª©ì°¨

- [Project Members](#project-members)
- [ì†Œê°œ](#ì†Œê°œ)
- [ê°œë°œ í™˜ê²½](#ê°œë°œ-í™˜ê²½)
- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
- [API ëª…ì„¸ì„œ](#api-ëª…ì„¸ì„œ)
- [í”„ë¡œì íŠ¸ ëª©ì ](#í”„ë¡œì íŠ¸-ëª©ì )
- [í™”ë©´ êµ¬ì„±](#í™”ë©´-êµ¬ì„±)
- [HAEBANG íšŒê³ ](#haebang-íšŒê³ )
- [ERD êµ¬ì¡°](#erd-êµ¬ì¡°)
- [í•µì‹¬ ê¸°ëŠ¥](#í•µì‹¬-ê¸°ëŠ¥)
  - [ë¡œê·¸ì¸/íšŒì›ê°€ì…](#ë¡œê·¸ì¸íšŒì›ê°€ì…)
  - [ì•„íŒŒíŠ¸ ë§¤ë§¤ ì •ë³´](#ì•„íŒŒíŠ¸-ë§¤ë§¤-ì •ë³´)
  - [ì¸ê¸° ê²€ìƒ‰ ìˆœìœ„](#ì¸ê¸°-ê²€ìƒ‰-ìˆœìœ„)
  - [ë§¤ë¬¼ CRUD](#ë§¤ë¬¼-crud)
  - [ê´€ë¦¬ì ë¬¸ì˜](#ê´€ë¦¬ì-ë¬¸ì˜)
  - [ê²€ìƒ‰ì–´ ìë™ì™„ì„±](#ê²€ìƒ‰ì–´-ìë™ì™„ì„±)
- [CI/CD](#cicd)
  - [CI](#ci)
  - [CD](#cd)
- [Trouble Shooting](#trouble-shooting)

## Project Members

<table>
   <tr>
    <td align="center"><b><a href="https://github.com/jeeyoun-kang">ê°•ì§€ìœ¤</a></b></td>
    <td align="center"><b><a href="https://github.com/jisoo615">í˜„ì§€ìˆ˜</a></b></td>
  <tr>
     <td align="center"><a href="https://github.com/jeeyoun-kang"><img src="https://avatars.githubusercontent.com/u/59076085?v=4" width="100px" /></a></td>
    <td align="center"><a href="https://github.com/jisoo615"><img src="https://avatars.githubusercontent.com/u/57720285?v=4" width="100px" /></a></td>
  </tr>
  <tr>
    <td align="center"><b>Backend Developer</b></td>
    <td align="center"><b>Backend Developer</b></td>
</table>








## ì†Œê°œ

**HAEBANG**ëŠ” ì„œìš¸ì‹œ ë‚´ ì•„íŒŒíŠ¸ ë§¤ë§¤ ì •ë³´ë¥¼ ì œê³µí•˜ê³  ìš°ë¦¬ë‚˜ë¼ ì „ì—­ì˜ ë§¤ë¬¼ ë“±ë¡ ë° ê±°ë˜ í• ìˆ˜ ìˆëŠ” ì›¹ì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. <br>



## ê°œë°œ í™˜ê²½

- Windows
- IntelliJ
- GitHub
- AWS

## ì‚¬ìš© ê¸°ìˆ 

**ë°±ì—”ë“œ**

- Java 11 openjdk
- SpringBoot 2.7.3
- Spring Security
- Spring Data JPA
- Lombok
- JWT

**í”„ë¡ íŠ¸ì—”ë“œ**

- Html5/css3
- Javascript
- Thymeleaf

**ë¹Œë“œ íˆ´**

- Gradle 7.6.1

**ë°ì´í„°ë² ì´ìŠ¤**

- Mysql
- Redis
- ElasticSearch 7.17.12

**ì¸í”„ë¼**

- AWS EC2
- AWS S3
- AWS RDS
- AWS LoadBalancer
- AWS Route 53
- Jenkins
- Docker

**ë¼ì´ë¸ŒëŸ¬ë¦¬**

- [KakaoMap Api](https://apis.map.kakao.com/)
- [ê³µê³µë°ì´í„° Api](https://www.data.go.kr/)
- [ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ Api](https://postcode.map.daum.net/guide)

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

![haebang_archi_final](https://github.com/HaeBangProject/HAEBANG/assets/59076085/ae7dfc0a-3f86-4ae6-8539-ba4eea9d3d97)


## API ëª…ì„¸ì„œ

### [Api ëª…ì„¸ì„œ ë³´ê¸°](https://documenter.getpostman.com/view/17346598/2s93kz659T)



## í”„ë¡œì íŠ¸ ëª©ì 

ì™¸ë¶€ API í™œìš©, í† í° ì¸ì¦ë°©ì‹, ì†Œì¼“í†µì‹ , ê²€ìƒ‰ í”„ë¡œì„¸ìŠ¤ë¥¼ ì ìš©í•˜ëŠ” ê²ƒê³¼ ê´€ë ¨ëœ ì „ë°˜ì ì¸ springbootì˜ ë™ì‘ì„ ì´í•´í•˜ê³  ì‹¤ì‚¬ìš©ìë¥¼ ê³ ë ¤í•œ ë°°í¬ê¹Œì§€ ì§„í–‰í•˜ëŠ” ê²ƒì´ ì£¼ëœ ëª©ì ì…ë‹ˆë‹¤.



## í™”ë©´ êµ¬ì„±

| [![main_haebang](https://github.com/HaeBangProject/HAEBANG/assets/59076085/17664fab-72c8-4a5c-b3a4-b7ce603bbb21)](https://github.com/HaeBangProject/HAEBANG/assets/59076085/17664fab-72c8-4a5c-b3a4-b7ce603bbb21) | [![login_haebang](https://github.com/HaeBangProject/HAEBANG/assets/59076085/8de9e11e-f82f-4943-a255-d54f2ddffa16)](https://github.com/HaeBangProject/HAEBANG/assets/59076085/8de9e11e-f82f-4943-a255-d54f2ddffa16) | [![haebang_1](https://github.com/HaeBangProject/HAEBANG/assets/59076085/68a06f62-4e25-4d7d-9351-1b56a850c29a)](https://github.com/HaeBangProject/HAEBANG/assets/59076085/68a06f62-4e25-4d7d-9351-1b56a850c29a) |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ë©”ì¸ í˜ì´ì§€                                                  | ë¡œê·¸ì¸/íšŒì›ê°€ì…                                              | ë§¤ë¬¼ë³´ê¸° í˜ì´ì§€                                              |

| [![mypage_1](https://github.com/HaeBangProject/HAEBANG/assets/59076085/54b3109d-430d-4b45-b077-a13447386334)](https://github.com/HaeBangProject/HAEBANG/assets/59076085/54b3109d-430d-4b45-b077-a13447386334) | [![haebang_bookmark](https://github.com/HaeBangProject/HAEBANG/assets/59076085/b69c1a91-13d7-4d22-8957-c986ac37f9fb)](https://github.com/HaeBangProject/HAEBANG/assets/59076085/b69c1a91-13d7-4d22-8957-c986ac37f9fb) | [![crud_haebang](https://github.com/HaeBangProject/HAEBANG/assets/59076085/923d88d4-a3a4-41f0-aa3c-cba9b1a1717e)](https://github.com/HaeBangProject/HAEBANG/assets/59076085/923d88d4-a3a4-41f0-aa3c-cba9b1a1717e) |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ë§ˆì´ í˜ì´ì§€->ë‚´ê°€ ì‘ì„±í•œ ê¸€                                  | ë§ˆì´í˜ì´ì§€->ë¶ë§ˆí¬í•œ ê¸€                                      | ì§‘ ë‚´ë†“ê¸° í˜ì´ì§€                                             |

| [![search_2](https://github.com/HaeBangProject/HAEBANG/assets/59076085/f2793768-b763-4eca-9b31-050efdfb77d5)](https://github.com/HaeBangProject/HAEBANG/assets/59076085/f2793768-b763-4eca-9b31-050efdfb77d5) | [![chatroom_haebang](https://github.com/HaeBangProject/HAEBANG/assets/59076085/5e23ed46-2388-4f05-b680-c7773f4f413e)](https://github.com/HaeBangProject/HAEBANG/assets/59076085/5e23ed46-2388-4f05-b680-c7773f4f413e) | [![chat_haebang](https://github.com/HaeBangProject/HAEBANG/assets/59076085/2028042b-a779-4474-8c7d-b223c123a322)](https://github.com/HaeBangProject/HAEBANG/assets/59076085/2028042b-a779-4474-8c7d-b223c123a322) |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ë©”ì¸í˜ì´ì§€-> ê²€ìƒ‰ì–´ ìë™ì™„ì„±                                 | ë¬¸ì˜í•˜ê¸° í˜ì´ì§€                                              | ë¬¸ì˜í•˜ê¸° í˜ì´ì§€ -> ì±„íŒ…                                      |

## HAEBANG íšŒê³ 

### [HAEBANG íšŒê³ ë¡](https://goofy-hoverfly-fbf.notion.site/fb804fd9cbca4e1298f111f9f21a75a2?v=98ca6cf74bb94745b5e16fd62c8b8bda)



## ERD-êµ¬ì¡°

![ERD](https://github.com/HaeBangProject/HAEBANG/assets/57720285/cd200289-7a10-4cdc-b00f-f860311edd6a)

## í•µì‹¬ ê¸°ëŠ¥

### ë¡œê·¸ì¸/íšŒì›ê°€ì…

- ì„¸ì…˜ë¡œê·¸ì¸ ëŒ€ì‹  JWT(Json Web Token)ì„ í™œìš©í•œ í† í°ì¸ì¦ë°©ì‹ì„ êµ¬í˜„
- í† í°ì„ ë‹´ì€ APIìš”ì²­ì„ í•„í„°ë¡œ ê²€ì¦ - ì ‘ê·¼ì œí•œ/í—ˆìš©
  - í† í° ì—­í• &ë§Œë£Œì‹œê°„
    - AccessToken( ATK ) = apiìš”ì²­ì‹œ í—¤ë”ì— ë„£ì–´ ë³´ë‚´ëŠ” í† í°, ë§Œë£Œì‹œê°„ì„ ë³´ë‹¤ ì§§ì€ 1ì‹œê°„ìœ¼ë¡œ ì„¤ì •
    - RefreshToken( RTK ) = ATKë¥¼ ì¬ë°œê¸‰í•˜ëŠ” ìš©ë„ì˜ í† í°, ë§Œë£Œì‹œê°„ì„ ë³´ë‹¤ ê¸´ 2ì£¼ë¡œ ì„¤ì •
- ê³¼ì •
  - ìµœì´ˆ ë¡œê·¸ì¸ ì‹œ AccessToken( ATK )ê³¼ RefreshToken( RTK ) ë‘ê°œë¥¼ ë°œê¸‰í›„ Redisì— RTKë¥¼ ì €ì¥
    - key[RTKí† í°] value[email] exp[ë‚¨ì€ì‹œê°„] ì €ì¥
      - ì¬ë°œê¸‰ì‹œ RTK í† í°ì´ ì¡´ì¬í• ë•Œ ATKì¬ë°œê¸‰ (íƒˆì·¨ëœ RTKë¥¼ ì‚¬ìš©ê¸ˆì§€í•˜ê¸° ìœ„í•¨)
  - ë¡œê·¸ì•„ì›ƒì‹œ Redisì—ì„œ RTKëŠ” ì‚­ì œí•˜ê³  ATKë¥¼ ì €ì¥
    - ê¸°í•œì´ ë‚¨ì•˜ì„ ATKë¥¼ ì‚¬ìš©ê¸ˆì§€ ìœ„í•´ key[ATKí† í°] value['logout'] exp[ë‚¨ì€ì‹œê°„] ì €ì¥
    - ê¸°ì¡´ ë“±ë¡ëœ RTKë¥¼ ì‚¬ìš©ê¸ˆì§€ ìœ„í•´ RTKë¥¼ ì‚­ì œ
- Redisë¥¼ í† í° ê´€ë¦¬ì— ì‚¬ìš©
  - ì—¬ëŸ¬ëŒ€ì˜ ì„œë²„ë¡œ ë¶„ì‚°ë  ì¸ë©”ëª¨ë¦¬ session dbë¥¼ ëŒ€ë¹„í•´ ì¸ë©”ëª¨ë¦¬ ì €ì¥ì†Œì¸ Redis ì—ì„œ ì‚¬ìš©ì í† í°ì„ ê´€ë¦¬
  - ë°ì´í„°ë¥¼ ì €ì¥í• ë•Œ ë§Œë£Œì‹œê°„ì„ ì§€ì •í•  ìˆ˜ ìˆì–´ì„œ ë§Œë£Œì‹œê°„ì´ ìˆëŠ” í† í°ë“¤ì„ ê´€ë¦¬í•˜ê¸°ì— ì í•©í•˜ë‹¤ê³  íŒë‹¨
- cookieì™€ localstorage
  - atkëŠ” ìì£¼ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ìë™ìœ¼ë¡œ ì‹¤ë¦¬ëŠ” Cookieì— ì €ì¥
  - rtkëŠ” ìì£¼ ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë‹ˆ localstorageì— ì €ì¥
- custom error response
  - íšŒì›ê°€ì…/ë¡œê·¸ì¸/í† í°ê²€ì¦ ê³¼ì •ì—ì„œ ë°œìƒí•œ ë¬¸ì œë¥¼ ì„¸ë¶„í™”
  - 400 - 500 ì‚¬ì´ì˜ ìƒíƒœì½”ë“œì¼ ê²½ìš° í† í° ì¬ë°œê¸‰
  - ì‚¬ìš©ìì—ê²Œ í•„ìš”í•œ ì¡°ì¹˜ë¥¼ ì•ˆë‚´

### ì•„íŒŒíŠ¸ ë§¤ë§¤ ì •ë³´

- KakaoMap apiì™€ ê³µê³µë°ì´í„° apië¥¼ ì´ìš©í•´ ì§€ë„ìƒ ì•„íŒŒíŠ¸ ìœ„ì¹˜ êµ¬í˜„ê³¼ ì§€ì—­ê³¼ ë…„ë„ë³„ ì•„ë§ˆíŠ¸ ë§¤ë§¤ ì •ë³´ë¥¼ ì œê³µ
  - ë§ˆì»¤ë¥¼ ì´ìš©í•´ ë§ˆì»¤ í´ë¦­ì‹œ ê±°ë˜ê¸ˆì•¡,ê³„ì•½ë‚ ì§œ,ê±´ì¶•ë…„ë„ ë“±ì˜ ì•„íŒŒíŠ¸ ë§¤ë§¤ ì •ë³´ë¥¼ ë„ì›€
- ê³µê³µë°ì´í„° apië¥¼ í˜¸ì¶œí•˜ëŠ” ë¡œì§ì„ Serviceì— êµ¬í˜„í•˜ê³  Controllerì—ì„œ ë…„,ì›”ê³¼ ì§€ì—­ì„ ì„ íƒí•˜ë©´ Serviceì—ì„œ í•´ë‹¹ ë§¤ë¬¼ì„ ì°¾ì•„ Dtoì— ì €ì¥í•´ Controllerì— Dtoë¥¼ ë°›ì•„ ê²°ê³¼ë¥¼ êµ¬í˜„

### ì¸ê¸° ê²€ìƒ‰ ìˆœìœ„

- Redisì˜ ìë£Œêµ¬ì¡°ì¸ Sorted Setì„ ì´ìš©í•˜ê³  Stringê°’ì„ key,valueë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´RedisTemplateì˜ StringRedisTemplateì„ ì´ìš©
  - Spring Data Redis ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ Lettuceë¥¼ ì‚¬ìš©í•´ Redisì™€ ì—°ë™
- opsForZset()ì˜ incrementScore()ë¥¼ ì´ìš©í•´ key ì•ˆì—ì„œ ê²€ìƒ‰ì–´(ì§€ì—­)ë¥¼ valueì— ì €ì¥í•˜ê³ , ê²€ìƒ‰ë ë•Œë§ˆë‹¤  deltaì— 1ì„ ì£¼ì–´ ìˆœìœ„ë¥¼ êµ¬í˜„
- key ì•ˆì—ì„œ delta ê¸°ì¤€ìœ¼ë¡œ 0~4ìˆœìœ„ë¥¼ ë¦¬ìŠ¤íŠ¸ì— ë‹´ì•„ Top5 êµ¬í˜„

### ë§¤ë¬¼ CRUD

- ì•„íŒŒíŠ¸ ë§¤ë¬¼ì„ ì‘ì„±í•˜ê³  ìˆ˜ì • ì‚­ì œ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì„ RESTful APIë¡œ êµ¬í˜„
  - entityì—ì„œ ì‘ì„±/ìˆ˜ì • ê°€ëŠ¥í•œ ì •ë³´ë§Œ ë‹´ì•„ dtoë¡œ ìš”ì²­/ì „ë‹¬
  - validationì„ ì‚¬ìš©í•´ ì •í˜•í™”ëœ ê°’ì„ ë°›ìŒ. ì¡°ê±´ì— ë§ì§€ ì•Šì„ì‹œ message ì „ë‹¬
  - ê°™ì€ ì£¼ì†Œì¼ ê²½ìš° 1:N (ì•„íŒŒíŠ¸ : ë§¤ë¬¼)ì˜ ê´€ê³„ë¡œ ì €ì¥
    - ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ apië¥¼ ì´ìš©í•´ ë„ë¡œëª… ì£¼ì†Œë¥¼ ì…ë ¥ë°›ì•„ ì¼ê´€ë˜ê³  ì •í™•í•œ ë°ì´í„° í™•ë³´
- ìˆ˜ì •, ì‚­ì œëŠ” ì‘ì„±ìì™€ í† í°ì—ì„œ ë„ì¶œí•œ ì‚¬ìš©ìì™€ ì¼ì¹˜í•˜ëŠ” ì§€ í™•ì¸ í›„ ì ‘ê·¼/ì œí•œ
- ì‚¬ì§„(Photo) ì—…ë¡œë“œ/ìˆ˜ì •/ì‚­ì œ
  - ë¦¬ì‚¬ì´ì§• ê±°ì³ ì‚¬ì§„ ìš©ëŸ‰ ì¤„ì„

  - ì˜¤ë¸Œì íŠ¸ ìŠ¤í† ë¦¬ì§€ì¸ AWS S3ì— ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ê³  ì‚­ì œ

  - mysql dbì—ëŠ” s3ì— ì—…ë¡œë“œí•˜ê³  ë°›ì€ URLì„ ì €ì¥í•´ì„œ ì‚¬ìš©

    - ê°€ìƒí˜¸ìŠ¤íŒ…ì£¼ì†Œ ì ‘ê·¼ì´ ë¶ˆê°€í•´ Path Styleë¡œ ë³€ê²½

- ë¶ë§ˆí¬(Bookmark) ê¸°ëŠ¥
  - item_idì™€ member_id ë¡œ ë³µí•©í‚¤ ìƒì„±í•´ boomark:item = N:1, bookmark:member = N:1 ê´€ê³„ í˜•ì„±

  - itemì— bookmarksë¥¼ í•¨ê»˜ ë³´ë‚´ í”„ë¡ íŠ¸ì—ì„œ ë¶ë§ˆí¬ ìœ ë¬´ í™•ì¸

### ê´€ë¦¬ì ë¬¸ì˜

- STOMPì™€ SockJSë¥¼ ì´ìš©í•´ ì±„íŒ…ì„ êµ¬í˜„í•˜ì—¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ê´€ë¦¬ìì™€ 1:1 ë¬¸ì˜ê°€ ê°€ëŠ¥í•˜ë„ë¡ êµ¬í˜„
  - ì„¸ì…˜ì„ ì§ì ‘ê´€ë¦¬ ì•Šê³  ì—¬ëŸ¬ ì±„íŒ…ë°©ì„ ê°œì„¤í•˜ê¸° ìœ„í•´ WebSocket ê¸°ë°˜ì˜ STOMP ì´ìš©
  - WebSocketì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì„œë²„-í´ë¼ì´ì–¸íŠ¸ ê°„ í†µì‹ ì´ ëŠê¸°ì§€ ì•Šê²Œ í•˜ê¸° ìœ„í•´ SockJSë¥¼ ì´ìš©
- Redisë¥¼ ì´ìš©í•´ ê´€ë¦¬ì ì±„íŒ…ë°©ì„ Topicìœ¼ë¡œ ì„¤ì •í•´ ì—¬ëŸ¬ ì„œë²„(Scale-out ë¶„ì‚°í™˜ê²½)ì—ì„œë„ ì±„íŒ…ë°©ì´ ìœ ì§€ë˜ë„ë¡ êµ¬í˜„
  - Redisì˜ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” pub/sub ì‹œìŠ¤í…œì„ êµ¬ì¶•í•´ ëª¨ë“  ì„œë²„ë“¤ì´ í•´ë‹¹ ì‹œìŠ¤í…œì„ í†µí•´ pub/sub ë©”ì„¸ì§€ë¥¼ ì£¼ê³ ë°›ë„ë¡ êµ¬í˜„
  - Redis Hashë¥¼ ì´ìš©í•´ ê³µí†µ Topic(ì±„íŒ…ë°©)ì„ ìƒì„±í•˜ê³  ì„œë²„ë³„ë¡œ ì±„íŒ…ë°©ì— ë§¤ì¹˜ë˜ëŠ” topicì •ë³´ë¥¼ Mapì— ë„£ì–´ roomIdë¡œ ì°¾ì„ìˆ˜ ìˆê²Œ êµ¬í˜„
  - stomp í—¤ë”ì— í† í°ì„ ë³´ë‚´ë©´ì„œ stomphandlerë¥¼ ê±°ì³ ìœ íš¨í•œ í† í°ì¸ì§€ ê²€ì¦í•´ ìœ ì € ì—¬ë¶€ë¥¼ êµ¬ë¶„í•˜ë©° websocketì˜ í†µì‹  ë³´ì•ˆì„ ê°•í™”

### ê²€ìƒ‰ì–´ ìë™ì™„ì„±

- Elasticsearchì™€ nori í˜•íƒœì†Œ ë¶„ì„ê¸°ë¥¼ ì´ìš©í•´ì„œ @Documentë¡œ apt ë°ì´í„°ë¥¼ ì¸ë±ì‹±í•´ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í–ˆì„ë•Œ ìë™ì™„ì„±ìœ¼ë¡œ ê²€ìƒ‰ ë°ì´í„°ê°€ ë³´ì´ê²Œ êµ¬í˜„
  - Apt ì—”í‹°í‹°ëŠ” JpaRepositoryë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ ElasticsearchRepositoryë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ElasticSearchì™€ ë§¤í•‘í•  AptDocument í´ë˜ìŠ¤ë¥¼ ë”°ë¡œ ìƒì„±í•´ ì ìš©
  - Docker ì»¨í…Œì´ë„ˆë¡œ elasticsearchë¥¼ ì‹¤í–‰í•œë’¤ , analyis-nori í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•´ apt ì¸ë±ìŠ¤ ì„¤ì •
  - ë§¤ë¬¼ì´ ìƒì„±ë˜ê±°ë‚˜ ì‚­ì œë ë•Œ apt ì¸ë±ìŠ¤ì—ë„ ì—…ë°ì´íŠ¸, ElasticsearchRepositoryë¥¼ ì´ìš©í•´ ê²€ìƒ‰ api(_search)ë¡œ ê²€ìƒ‰ ë°ì´í„°ë¥¼ ì°¾ìŒ
  - ElasticSearch ë„ì»¤ ì»¨í…Œì´ë„ˆê°€ ì¤‘ì§€ë˜ê±°ë‚˜ ë‹¤ì‹œ ì‹¤í–‰í•´ë„ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ê²Œ í˜¸ìŠ¤íŠ¸ ê²½ë¡œì™€ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²½ë¡œë¥¼ ì—°ê²°í•˜ëŠ” ë³¼ë¥¨ë§ˆìš´íŠ¸ë¥¼ ì„¤ì •


## CI/CD

### CI

* Githubì—ì„œ ë¹Œë“œê°€ ë˜ë©´ ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆì—ì„œ ì  í‚¨ìŠ¤ íŒŒì´í”„ë¼ì¸ ì„¤ì •ìœ¼ë¡œ DockerFileì„ í†µí•´ jaríŒŒì¼ì´ ìƒì„±ë˜ê³ , ë¹Œë“œí•œ ì´ë¯¸ì§€ë¥¼ DockerHubì— pushí•˜ê²Œ ì„¤ì •
  * Githubì˜ Webhook ê¸°ëŠ¥ì„ ì´ìš©í•´ Jenkinsì— ìë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°ë¥¼ ìœ ë°œí•˜ê²Œ ì„¤ì •
  * [ì  í‚¨ìŠ¤ íŒŒì´í”„ë¼ì¸](https://github.com/HaeBangProject/HAEBANG/blob/6b554b93ec869c785225ab4c8348d0a4c91b9505/jenkins_pipeline#L1)
    * sed ëª…ë ¹ì–´ë¡œ ì„¤ì •íŒŒì¼ì˜ secretê°’ë“¤ì„ íŒŒì´í”„ë¼ì¸ì˜ ë³€ìˆ˜ë¡œ ì¹˜í™˜í•´ secretê°’ë“¤ì„ ì£¼ì…í•´ì¤Œ
    * ì  í‚¨ìŠ¤ ë„ì»¤ ì»¨í…Œì´ë„ˆì—ì„œ ì“°ì§€ì•ŠëŠ” ë°ì´í„°ë“¤ì„ ì‚­ì œí•˜ê²Œ ë§Œë“¤ì–´ ë¶ˆí•„ìš”í•œ ìš©ëŸ‰ì´ ìŒ“ì´ì§€ ì•Šê²Œ ì„¤ì •

### CD

* ì  í‚¨ìŠ¤ íŒŒì´í”„ë¼ì¸ì„ ì´ìš©í•´ ë°°í¬ ì„œë²„ì—ì„œ deploy ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ì‹¤í–‰í•´ ì´ë¯¸ì§€ë¥¼ pullë°›ì•„ 3ëŒ€ì˜ ì„œë²„ë¡œ ë‚˜ëˆ  ë¶„ì‚°í™˜ê²½ìœ¼ë¡œ ì‹¤í–‰ë˜ê²Œ êµ¬í˜„
  - 3ê°œì˜ ë„ì»¤ ì»¨í…Œì´ë„ˆ ì„œë²„ë¥¼ nginxì˜ ìµœì†Œì—°ê²°(least_conn) ë°©ì‹ìœ¼ë¡œ ë¡œë“œë°¸ëŸ°ì‹±

- https í”„ë¡œí† ì½œ ì‚¬ìš©ì„ ìœ„í•´ awsì˜ ALB(application load balancer)ì™€ ACM(AWS Certificate Manager)ë¥¼ ìƒì„±í•´ ì‚¬ìš©
  - Let's Encrypt ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•´ SSLê¹Œì§€ nginxì—ì„œ ìˆ˜í–‰í•˜ëŠ” ê²ƒë³´ë‹¤ AWSì—ì„œ í¸ë¦¬í•˜ê²Œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ë‚˜ëˆ„ì–´ ì§„í–‰


- ë¬´ì¤‘ë‹¨ ë°°í¬ ( ë¡¤ë§ ë°°í¬ )
  - ë¡¤ë§ë°°í¬ ë°©ì‹ì„ ìœ„í•´ [ìŠ¤í¬ë¦½íŠ¸](https://github.com/HaeBangProject/HAEBANG/blob/5694f437389f620e76f97a57a0180739bc6ec2d2/deploy.sh)ë¡œ 3ê°œì˜ ì„œë²„ë¥¼ ì°¨ë¡€ë¡œ ë°°í¬í›„ health check ì—ì„œ upì´ë©´ ë‹¤ìŒ ë°°í¬ ì§„í–‰
  - ë²„ì „ í˜¸í™˜ì„ ìœ„í•´ 1 ë°°í¬ í›„ upì´ë©´ ë‚˜ë¨¸ì§€ ì„œë²„ down í•˜ì—¬ íŠ¸ë˜í”½ì´ ê°€ì§€ ì•Šë„ë¡ í•¨

## Trouble Shooting

- ì¸ê¸° ì§€ì—­ ê²€ìƒ‰ ìˆœìœ„ë¥¼ êµ¬í˜„í•˜ëŠ” ê³¼ì •ì—ì„œ Redisì˜ Zset ìë£Œêµ¬ì¡°ëŠ” ë™ì ì²˜ë¦¬ë¥¼ ì§€ì›í•´ì£¼ì§€ ì•Šì•„ ê³µë™ ìˆœìœ„ë¥¼ êµ¬í˜„í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒ

  - Map.Entity ìë£Œêµ¬ì¡°ë¥¼ ì´ìš©í•´ scoreê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ì‹œ ê²€ìƒ‰ë°ì´í„°ë¥¼ ë¶„ë¥˜í•œ ë’¤, ê°™ì€ scoreê°’ì„ ê°€ì§„ ë°ì´í„°ë¥¼ ì¹´ìš´íŠ¸ í•´ reverseRange()ë¥¼ ì´ìš©í•´ ë™ì ì²˜ë¦¬ ëœ ë°ì´í„°ë„ ê³µë™ìˆœìœ„ì— ë“¤ì–´ê°€ê²Œ êµ¬í˜„

  ```java
  List<Map.Entry<Double, Integer>> sortedList = new ArrayList<>(score.entrySet());
          //keyì¸ scoreê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
          sortedList.sort(Collections.reverseOrder(Map.Entry.comparingByKey()));
          int same_score=0;
  
      
          //scoreê°€ TOP 5 ì•ˆì— ë“¤ì–´ê°€ê³  ,ê°™ì€ scoreë¥¼ ê°€ì§„ ë°ì´í„°ê°€ 2ê°œì´ìƒì¼ë•Œ
  				//same_score ë³€ìˆ˜ì— ì¹´ìš´íŠ¸
          for (int i = 0; i <= 4 && i < sortedList.size(); i++) {
              Map.Entry<Double, Integer> entry = sortedList.get(i);
              if(entry.getValue()>1) {
                  same_score += entry.getValue() - 1;
                  System.out.println("Score: " + entry.getKey() + ", Value: " + entry.getValue());
              }
          }
          // ê³µë™ìˆœìœ„ë¥¼ í¬í•¨í•œ TOP5
          Set<String> scoreRange = stringStringZSetOperations.reverseRange("ranking",0,4+same_score);
  ```



- Scale-out ë¶„ì‚°í™˜ê²½ì—ì„œ ì±„íŒ…ë°©ì˜ ë©”ì¸ ì €ì¥ì†Œ ì—†ì´ DTOë¡œ ì±„íŒ…ë°©ì„ ì„¤ì •í•´ ì„œë²„ ì¬ì‹œì‘í• ë•Œë§ˆë‹¤ ì±„íŒ…ë°©ì´ ì´ˆê¸°í™” ë˜ëŠ” ë¬¸ì œì™€ ì—¬ëŸ¬ ì„œë²„ì—ì„œ ì±„íŒ…ë°© ì ‘ì†ê³¼ ë©”ì„¸ì§€ë¥¼ ì£¼ê³ ë°›ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒ

  - Redisë¥¼ ì´ìš©í•´ ì±„íŒ…ë°©ì„ ê³µí†µ Topicìœ¼ë¡œ êµ¬í˜„í•œ ë’¤ pub/sub ì‹œìŠ¤í…œì„ êµ¬ì¶•í•´ ë©”ì„¸ì§€ë¥¼ ì£¼ê³ ë°›ë„ë¡ êµ¬í˜„í•´ í•´ê²°
    - ì±„íŒ…ë°© ì •ë³´ê°€ ì´ˆê¸°í™” ë˜ì§€ ì•Šë„ë¡ ìƒì„±ì‹œ redis HashOperations êµ¬ì¡°ë¥¼ ì´ìš©í•´ â€˜CHATROOMâ€™ì„ Hash keyê°’ìœ¼ë¡œ ê°–ê³ , ì±„íŒ…ë°© idì„ Hash Fieldë¡œ , ì±„íŒ…ë°© ê°ì²´ë¥¼ Hash Valueë¡œ ì €ì¥í•´ ì±„íŒ…ë°©ì˜ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ì¡°íšŒ
    - ì±„íŒ…ë°© ì…ì¥ì‹œì—ëŠ” ì±„íŒ…ë°© idë¡œ redis topic(ì±„íŒ…ë°©)ì„ ì¡°íšŒí•´ pub/subë©”ì„¸ì§€ ë¦¬ìŠ¤ë„ˆì™€ ì—°ë™

  ```java
  public class ChatRoomRepository {
      // ì±„íŒ…ë°©(topic)ì— ë°œí–‰ë˜ëŠ” ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•  Listner
      private final RedisMessageListenerContainer redisMessageListener;
      // êµ¬ë… ì²˜ë¦¬ ì„œë¹„ìŠ¤
      private final RedisSubscriber redisSubscriber;
      // Redis
      private static final String CHAT_ROOMS = "CHAT_ROOM";
      private final RedisTemplate<String, Object> redisTemplate;
      private HashOperations<String, String, ChatRoom> opsHashChatRoom;
      // ì±„íŒ…ë°©ì˜ ëŒ€í™” ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ê¸° ìœ„í•œ redis topic ì •ë³´
  		// ì„œë²„ë³„ë¡œ ì±„íŒ…ë°©ì— ë§¤ì¹˜ë˜ëŠ” topicì •ë³´ë¥¼ Mapì— ë„£ì–´ roomIdë¡œ ì°¾ì„ìˆ˜ ìˆë„ë¡ êµ¬í˜„
      private Map<String, ChannelTopic> topics;
  
      @PostConstruct
      private void init() {
          opsHashChatRoom = redisTemplate.opsForHash();
          topics = new HashMap<>();
      }
      public List<ChatRoom> findAllRoom() {
          return opsHashChatRoom.values(CHAT_ROOMS);
      }
      public ChatRoom findRoomById(String id) {
          return opsHashChatRoom.get(CHAT_ROOMS, id);
      }
      // ì±„íŒ…ë°© ìƒì„± : ì„œë²„ê°„ ì±„íŒ…ë°© ê³µìœ ë¥¼ ìœ„í•´ redis hashì— ì €ì¥í•œë‹¤.
      public ChatRoom createChatRoom(String name,String username) {
          ChatRoom chatRoom = ChatRoom.create(name,username);
          // CHAT_ROOM í‚¤ì— ëŒ€í•œ redis hash êµ¬ì¡°ì— ì±„íŒ…ë°©ì˜ idë¥¼ keyë¡œ í•˜ê³  , í•´ë‹¹ ì±„íŒ…ë°©ê°ì²´(chatRoom)ë¥¼ valueë¡œ ì €ì¥
          opsHashChatRoom.put(CHAT_ROOMS, chatRoom.getRoomId(), chatRoom);
          return chatRoom;
      }
  ```



- ë°°í¬ê°€ ì—…ë°ì´íŠ¸ ë ë•Œë§ˆë‹¤ redis ì»¨í…Œì´ë„ˆì˜ ì €ì¥ëœ key ê°’ì´ ì‚¬ë¼ì§€ëŠ” ë¬¸ì œê°€ ë°œìƒ

  - redis ê¸°ë³¸í¬íŠ¸ê°€ ì—´ë ¤ìˆê³ , ì¸ì¦ì—†ì´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì¼ë•Œ, í¬ë¡¤ëŸ¬ë´‡ì´ í•´ë‹¹ë˜ëŠ” redisì— ì ‘ê·¼í•˜ì—¬ ëª¨ë“  í‚¤ë¥¼ ì§€ìš°ê³  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¬ëŠ” ë¬¸ì œê°€ ì›ì¸
  - redis-clië¥¼ ì„¤ì •í• ë•Œ --requirepass [password] ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ ë¬¸ì œë¥¼ í•´ê²°

  ```shell
  docker run -v /path/on/host:/data \ 
  --name my-redis \
  -p 6379:6379 \ 
  -d redis:latest redis-server --appendonly yes --requirepass 'ë¹„ë°€ë²ˆí˜¸'
  ```



- spring Security 5.7 & JWT ë³€ê²½ì‚¬í•­

  - spring boot 2.7.3 ì€ spring security 5.7 ë²„ì „ì„ í¬í•¨
  - 5.7ë²„ì „ì€ ì–´ëŒ‘í„°ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  bean ë“±ë¡ë°©ì‹ì„ ì‚¬ìš©í•˜ë„ë¡ ë°”ë€Œì—ˆê¸° ë•Œë¬¸ì— ì˜¤ë²„ë¼ì´ë“œ í•´ì„œ êµ¬í˜„í–ˆë˜ ë°©ì‹ ëŒ€ì‹  beanìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ì‚¬ìš© WebSecurityConfigurerAdapter (ê¸°ì¡´) â†’ FilterChain (ë³€ê²½)

  ``` java 
  @Configuration
  @EnableWebSecurity
  @RequiredArgsConstructor
  public class SecurityConfig {
   private final JwtProvider jwtProvider;
  
  @Bean
  SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
      http
              .httpBasic().disable()
              .csrf().disable() // cross site ë„ë©”ì¸ ë‹¤ë¥¼ë•Œ í—ˆìš©
              .cors() //cross site
              .and()
              .formLogin().disable()
              .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
              .and()
              .addFilterBefore(new JwtAuthenticationFilter(jwtProvider), UsernamePasswordAuthenticationFilter.class);
              // UsernamePasswordAuthenticationFilter í•„í„°ë¥¼ ê±°ì¹˜ê¸° ì „ì— jwtí•„í„°ë¥¼ ê±°ì¹˜ë„ë¡ ì„¤ì •
      return http.build();
    }
  
  @Bean
  public HttpFirewall defaultHttpFirewall(){
      return new DefaultHttpFirewall();
    }
  }
  ```

  - new release 1.0.x ë¶€í„° parse ëŒ€ì‹  builder()ë¡œ, <u>signWith( ì•Œê³ ë¦¬ì¦˜, ì„¸ê°€ì§€í˜•íƒœì‹œí¬ë¦¿í‚¤)</u>ì—ì„œ <u>signWith( byte[]í˜•ë§Œë˜ëŠ”ì‹œí¬ë¦¿í‚¤, ì•Œê³ ë¦¬ì¦˜ )</u> ìœ¼ë¡œ ë³€ê²½
  - signWithì— í•„ìš”í•œ ì‹œí¬ë¦¿í‚¤ëŠ” Keys.hmacShaKeyFor('keyBytes')ë¡œ ì¸ì½”ë”© ëœ í‚¤ë¡œ signí•˜ë„ë¡ ë³€ê²½ ('keybytes'ëŠ” 32byteë³´ë‹¤ ê¸¸ì–´ì•¼ í•¨)

  ``` java 
  public class JwtProvider {
   private final Key key;
   private final RedisService redisService;
   private final MemberRepository memberRepository;
  
      public JwtProvider(@Value("${jwt.secret}") String secretKey, RedisService redisService, MemberRepository memberRepository){
          byte[] keyBytes = Base64.getDecoder().decode(secretKey);
          key = Keys.hmacShaKeyFor(keyBytes);
  
          this.redisService = redisService;
          this.memberRepository = memberRepository;
      }
  }
  ```

- ìœ íš¨í•˜ì§€ ì•Šì€ tokenì— ëŒ€í•´ì„œ ì±„íŒ…ë°©ì ‘ì†ê³¼ ë©”ì‹œì§€ ì²˜ë¦¬ë¥¼ í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œ ë°œìƒí•´ SpringSecuirtyë¡œ ì ‘ê·¼ ê¶Œí•œê³¼ Jwtë¥¼ ì¸ì¦í•´ Websocket í†µì‹  ë³´ì•ˆì„ ê°•í™”í•´ì¤Œ

  - SecurityFilterChainì—ì„œ .antMatchers(  "/chat/**").authenticated() ìœ¼ë¡œ ì ‘ê·¼ ê¶Œí•œì„ ì„¤ì •
  - stompì˜ í—¤ë”ì— access_tokenì„ ë„£ì–´ ì „ì†¡í•˜ë©´ stomp hadlerì—ì„œ CONNECT, SENDì˜ ê²½ìš° í† í°ì„ ê²€ì¦

  ```java
  public class StompHandler implements ChannelInterceptor {
  
      private final JwtProvider jwtProvider;
      @Override
      public Message<?> preSend(Message<?> message, MessageChannel channel) {
          StompHeaderAccessor accessor = StompHeaderAccessor.wrap(message);
  		// connect ë˜ëŠ” sendì´ë©´ ìœ íš¨í•œ í† í°ì¸ì§€ ê²€ì¦
          if(accessor.getCommand() == StompCommand.CONNECT) {
              if(!jwtProvider.validateToken(accessor.getFirstNativeHeader("token")))
                  throw new AccessDeniedException("");
          }
          else if(accessor.getCommand() == StompCommand.SEND){
              if(!jwtProvider.validateToken(accessor.getFirstNativeHeader("token")))
                  throw new AccessDeniedException("");
          }
  
          return message;
      }
  
  }
  ```

- JPA ì–‘ë°©í–¥ ì—°ê´€ ê´€ê³„ë¥¼ ê°€ì§„ ê°ì²´ë“¤ì„ ì‘ë‹µ ì‹œì— JSON ì§ë ¬í™”í•˜ëŠ” ê³¼ì •ì—ì„œ ìˆœí™˜ ì°¸ì¡° ë¬¸ì œê°€ ë°œìƒ

  - @JsonIgnore ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ í•„ìš”í•˜ì§€ ì•ŠëŠ” ê°ì²´ëŠ” ì œì™¸
  - ì§€ì—°ë¡œë”© ì˜µì…˜ì„ ì„ íƒí–ˆì„ ê²½ìš° @JsonIgnoreProperties({"hibernateLazyInitializer", "handler"}) ì¶”ê°€

  ``` java
  @JsonIgnoreProperties({"hibernateLazyInitializer", "handler"})
  @Getter
  @NoArgsConstructor(force = true)
  @AllArgsConstructor
  @Builder
  @Entity
  public class Member implements UserDetails {// userì€ ddlì˜ˆì•½ì–´ë¡œ memberë¡œ ë³€ê²½
   @Id
   @GeneratedValue(strategy = GenerationType.IDENTITY)
   private Long userId;
   @JsonIgnore
   @NotNull
   private String password;
  // ì¤‘ëµ
   @JsonIgnore
   @Builder.Default
   @OneToMany(mappedBy = "member", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
   List<Item> items = new ArrayList<>(); 
  // ì¤‘ëµ
  }
  ```

  - ë³µì¡í•œ Entityì˜ ê²½ìš° @JsonIgnore ë§Œìœ¼ë¡œ í•´ê²°ì´ ë¶ˆê°€í•´ ìƒˆë¡œìš´ response ìš© Dtoë¥¼ ë§Œë“¤ì–´ í•„ìš”í•œ ì •ë³´ë§Œ ë„£ì–´ ë°˜í™˜

  ``` java 
  @JsonNaming(PropertyNamingStrategy.SnakeCaseStrategy.class)
  @Data
  public class AptItemRes {
  @JoinColumn(name = "data")
  AptItemReq aptItemReq;
  List<S3File> s3Files = new ArrayList<>();
  } 
  ```

- ì—°ê´€ëœ Entityê°€ ì‚­ì œ/ìƒì„±ì‹œ ì—°ë™ë˜ì§€ ì•ŠëŠ” ë¬¸ì œ

  - bookmark ì— item, memeberê°€ ìˆì–´ item ì‚­ì œì‹œ bookmark ë•Œë¬¸ì— ì§€ì›Œì§€ì§€ ì•ŠëŠ” í˜„ìƒ & item ì‚­ì œì‹œ S3Fileì´ ë‚¨ì•„ìˆëŠ” í˜„ìƒ
  - itemì‚­ì œì‹œ ê´€ë ¨ëœ bookmarkì™€ S3Fileì´ ì§€ì›Œì§€ë„ë¡ ì„¤ì • cascade = CascadeType.REMOVE, CascadeType.ALL

  ``` java
  @Builder.Default
  @OneToMany(mappedBy = "item", cascade = CascadeType.ALL)
  List<S3File> s3Files = new ArrayList<>();
  
  @Builder.Default
  @OneToMany(mappedBy = "item", cascade = CascadeType.REMOVE)
  List<Bookmark> bookmarks = new ArrayList<>(); 
  ```
  - ë§¤ë¬¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì•„íŒŒíŠ¸ ë°ì´í„°ê°€ ë‚¨ì•„ì•˜ê³  ê²€ìƒ‰ì–´ ìë™ì™„ì„±ì— ëœ¨ëŠ” ë¬¸ì œ
  - Aptì— Itemìƒì„±/ì‚­ì œì‹œ ì¦ê°€/ê°ì†Œí•˜ëŠ” ì¹´ìš´íŠ¸ë¥¼ ë§Œë“¤ì–´ 0ì´ ë ë•Œ Aptì™€ AptDocument (elastic search)ë¥¼ ì‚­ì œ

  ``` java 
  public boolean deleteItem(String username, Long idx){
      Item item = itemRepository.findById(idx).orElseThrow();
  
        if(!item.getUsername().equals(username)) throw new CustomException(CustomErrorCode.INVALID_EDIT_USER);
        itemRepository.deleteById(idx);
        item.getApt().decreaseCnt();
  
        if(item.getApt().getCnt() > 0){
            aptRepository.save(item.getApt());
        }else{
            // ë”ì´ìƒ ì¡´ì¬í•˜ëŠ” item ì´ì—†ëŠ” apt ì¼ ê²½ìš° - db ì• ì„œ ì§€ìš°ê³ , ê²€ìƒ‰ì— ì•ˆëœ¨ê²Œ elastic search ì• ì„œë„ ì§€ìš°ê¸°
            aptRepository.delete(item.getApt());
            aptSearchRepository.delete(AptDocument.from(item.getApt()));
        }
        return true;
    } 
  ```